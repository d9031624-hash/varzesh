<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>ماشین حساب پیشرفته وضعیت بدن — دقیق</title>
<style>
/* ===== فونت و تنظیمات پایه ===== */
:root{--bg:#0f1720;--card:#0b1220;--accent:#00d1d9;--muted:#98a2b3;--glass:rgba(255,255,255,0.03)}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:system-ui,-apple-system,"Segoe UI","Helvetica Neue","BNazanin",sans-serif;background:
linear-gradient(180deg,#071226 0%, #071b2d 60%);color:#e6eef3;direction:rtl;}
.container{max-width:920px;margin:28px auto;padding:22px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));box-shadow:0 8px 30px rgba(2,6,23,0.8);}

/* شبکه دو ستونی (رسپانسیو) */
.grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
@media (max-width:880px){.grid{grid-template-columns:1fr}}

/* کارت ورودی */
.card{background:var(--card);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
h1{margin:0 0 8px;font-size:20px;color:var(--accent)}
label{display:block;font-size:14px;color:var(--muted);margin-bottom:6px}
.input-row{display:flex;gap:10px;align-items:center}
.input-row .col{flex:1}
input[type="number"], input[type="text"], select{
  width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);
  background:transparent;color:inherit;font-size:15px;outline:none;
}
input[type="number"]::-webkit-outer-spin-button,input[type="number"]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}

/* دکمه */
.btn{
  display:inline-block;padding:11px 16px;border-radius:10px;background:linear-gradient(90deg,var(--accent),#00a6b0);
  color:#02121a;font-weight:700;border:none;cursor:pointer;font-size:15px;
  box-shadow:0 6px 18px rgba(0,209,217,0.12), inset 0 -2px 6px rgba(0,0,0,0.15);
}
.btn:active{transform:translateY(1px)}

/* بخش خروجی */
.output{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}
.output h3{margin:0 0 8px;color:#bfeef0}
.metric{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px dashed rgba(255,255,255,0.03);font-size:15px}
.metric:last-child{border-bottom:0}
.small{font-size:13px;color:var(--muted)}

/* لودینگ هوشمند (مدال) */
#loadingModal{
  position:fixed;inset:0;display:none;justify-content:center;align-items:center;z-index:9999;
  background:linear-gradient(180deg, rgba(2,6,23,0.6), rgba(2,6,23,0.85));
}
.loader-card{width:360px;max-width:94%;padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));text-align:center;border:1px solid rgba(255,255,255,0.03)}
.orbits{position:relative;width:110px;height:110px;margin:6px auto 12px}
.orbit-ring{position:absolute;inset:0;border-radius:50%;border:3px solid rgba(0,209,217,0.09);animation:rot 3s linear infinite}
.orbit-ring.r2{border-width:2px;width:86px;height:86px;left:12px;top:12px;animation-duration:2.6s}
.orbit-ring.r3{border-width:1.6px;width:62px;height:62px;left:24px;top:24px;animation-duration:2.2s}
.core{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:24px;height:24px;border-radius:50%;background:linear-gradient(180deg,#00fff5,#00a6b0);box-shadow:0 0 24px rgba(0,209,217,0.22)}
@keyframes rot{to{transform:rotate(360deg)}}

/* نوار پیشرفت */
.progress-wrap{height:10px;background:rgba(255,255,255,0.03);border-radius:999px;overflow:hidden;margin-top:10px}
.progress-bar{height:100%;width:0%;background:linear-gradient(90deg,#00eaff,#00a6b0);transition:width 200ms linear}

/* هشدار و ارور */
.warn{background:linear-gradient(90deg,#3b2f2f,#2d1f1f);color:#ffdede;padding:10px;border-radius:8px;font-size:14px}

/* توضیحات کوچک */
.note{font-size:13px;color:var(--muted);margin-top:8px}
.footer-small{margin-top:14px;font-size:13px;color:var(--muted)}
</style>
</head>
<body>

<div class="container" role="main" aria-labelledby="title">
  <h1 id="title">ماشین حساب قدرتمند وضعیت بدن — دقیق</h1>

  <div class="grid">
    <!-- ورودی‌ها -->
    <div class="card">
      <label>قد (سانتی‌متر)</label>
      <input id="height" type="number" placeholder="مثال: 170" min="30" max="272" step="0.1" />

      <label style="margin-top:10px">وزن (کیلوگرم)</label>
      <input id="weight" type="number" placeholder="مثال: 70" min="2" max="635" step="0.1" />

      <div style="display:flex;gap:10px;margin-top:10px">
        <div style="flex:1">
          <label>سن (سال)</label>
          <input id="age" type="number" placeholder="مثال: 30" min="0" max="120" step="1" />
        </div>
        <div style="width:130px">
          <label>جنسیت</label>
          <select id="sex">
            <option value="male">مرد</option>
            <option value="female">زن</option>
          </select>
        </div>
      </div>

      <label style="margin-top:12px">سطح فعالیت (برای کالری)</label>
      <select id="activity">
        <option value="1.2">خیلی کم (نشسته)</option>
        <option value="1.375">کم (ورزش سبک 1-3 روز/هفته)</option>
        <option value="1.55" selected>متوسط (ورزش 3-5 روز/هفته)</option>
        <option value="1.725">زیاد (ورزش سنگین 6 روز/هفته)</option>
        <option value="1.9">خیلی زیاد (کار فیزیکی یا ورزش بسیار سنگین)</option>
      </select>

      <div style="margin-top:12px" class="small">برای دقت بالاتر درصد چربی (روش نیوی) می‌توانید اندازه‌گیری‌های دور کمر/گردن/هیپ را وارد کنید — <span style="color:var(--accent)">اختیاری</span></div>

      <div style="display:flex;gap:10px;margin-top:10px">
        <div class="col">
          <label>دور کمر (سانتی‌متر)</label>
          <input id="waist" type="number" placeholder="مثال: 85" min="30" max="300" step="0.1" />
        </div>
        <div class="col">
          <label>دور گردن (سانتی‌متر)</label>
          <input id="neck" type="number" placeholder="مثال: 38" min="20" max="80" step="0.1" />
        </div>
      </div>

      <div style="margin-top:10px">
        <label>دور لگن / هیپ (فقط برای زنان، سانتی‌متر)</label>
        <input id="hip" type="number" placeholder="مثال: 98" min="30" max="300" step="0.1" />
      </div>

      <div style="margin-top:14px;display:flex;gap:10px;align-items:center">
        <button class="btn" id="calcBtn">محاسبه دقیق</button>
        <button class="btn" id="clearBtn" style="background:rgba(255,255,255,0.06);color:var(--accent)">پاک کردن</button>
      </div>

      <div class="note">تمام محاسبات با استفاده از فرمول‌های استاندارد (BMI, Deurenberg, Navy, Mifflin-St Jeor, Devine) انجام می‌شود. برای بیشترین دقت، دور کمر/گردن/هیپ را پر کنید.</div>
    </div>

    <!-- خروجی‌ها -->
    <div class="card output" aria-live="polite">
      <h3>نتایج</h3>

      <div id="resultsArea">
        <div class="metric"><div class="small">BMI</div><div id="outBMI">—</div></div>
        <div class="metric"><div class="small">گروه وزنی</div><div id="outStatus">—</div></div>
        <div class="metric"><div class="small">درصد چربی بدن (تقریبی)</div><div id="outFat">—</div></div>
        <div class="metric"><div class="small">شاخص چربی (روش نیوی - در صورت وارد کردن اندازه‌ها)</div><div id="outFatNavy">—</div></div>
        <div class="metric"><div class="small">وزن ایده‌آل (BMI=22)</div><div id="outIdealBMI">—</div></div>
        <div class="metric"><div class="small">وزن ایده‌آل (فرمول دیواین)</div><div id="outIdealDevine">—</div></div>
        <div class="metric"><div class="small">توده بدون چربی (LBM)</div><div id="outLBM">—</div></div>
        <div class="metric"><div class="small">BMR (استراحتی — Mifflin-St Jeor)</div><div id="outBMR">—</div></div>
        <div class="metric"><div class="small">TDEE (با توجه به فعالیت)</div><div id="outTDEE">—</div></div>

        <div id="advice" style="margin-top:12px"></div>
      </div>

      <div class="footer-small">ابزار برای اهداف اطلاعاتی طراحی شده است و جایگزین مشاوره پزشکی یا تغذیه حرفه‌ای نیست.</div>
    </div>
  </div>
</div>

<!-- Modal لودینگ هوشمند -->
<div id="loadingModal" role="status" aria-hidden="true">
  <div class="loader-card" aria-live="polite">
    <div style="font-weight:700;color:var(--accent)">در حال پردازش دقیق داده‌ها...</div>

    <div class="orbits" aria-hidden="true">
      <div class="orbit-ring r1"></div>
      <div class="orbit-ring r2"></div>
      <div class="orbit-ring r3"></div>
      <div class="core"></div>
    </div>

    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px">
      <div class="small">وضعیت:</div>
      <div id="loadingStep" class="small">آماده‌سازی</div>
    </div>

    <div class="progress-wrap" aria-hidden="true">
      <div class="progress-bar" id="progressBar" style="width:0%"></div>
    </div>

    <div class="small" style="margin-top:10px;color:var(--muted)">لودینگ هوشمند — دقت محاسبات با بررسی ورودی‌ها بهینه می‌شود.</div>
  </div>
</div>






<!-- جلوگیری از انتخاب و کپی متن (CSS + JS) -->
<style>
/* غیرقابل انتخاب کردن متن در کل صفحه */
* {
  -webkit-user-select: none !important;
  -moz-user-select: none !important;
  -ms-user-select: none !important;
  user-select: none !important;
  -webkit-touch-callout: none !important; /* iOS callout */
}

/* اگر می‌خواهی فرم‌ها/اینپوت‌ها هم غیرقابل انتخاب باشند (پیش‌فرض همینطور است).
   در صورت تمایل می‌توان این خط را حذف کرد تا ورودی‌ها قابل انتخاب بمانند. */
/* input, textarea, select { user-select: none !important; } */
</style>

<script>
// جلوگیری از منوی راست‌کلیک
document.addEventListener('contextmenu', function(e){ e.preventDefault(); }, {passive:false});

// جلوگیری از تلاش‌های کپی/برش/چسباندن
['copy','cut','paste'].forEach(evt=>{
  document.addEventListener(evt, function(e){ e.preventDefault(); }, {passive:false});
});

// جلوگیری از انتخاب متن (ماحصل: پاک کردن محدوده انتخاب)
document.addEventListener('selectionchange', function(){
  const s = document.getSelection();
  if(s && s.rangeCount) {
    // حذف فوری هر انتخاب
    s.removeAllRanges();
  }
});

// جلوگیری از کشیدن (drag) متن
document.addEventListener('dragstart', function(e){ e.preventDefault(); }, {passive:false});

// جلوگیری از کلیدهای میانبر کپی/چسباندن/برش/ذخیره/انتخاب همه
document.addEventListener('keydown', function(e){
  const key = e.key.toLowerCase();
  if ((e.ctrlKey || e.metaKey) && (key === 'c' || key === 'x' || key === 'v' || key === 'a' || key === 's' || key === 'p')) {
    e.preventDefault();
  }
  // همچنین جلوگیری از کلیدهای Shift+Arrow selection (اختیاری)
  if (e.shiftKey && (key === 'arrowleft' || key === 'arrowright' || key === 'arrowup' || key === 'arrowdown')) {
    e.preventDefault();
  }
}, {passive:false});

// جلوگیری از شروع انتخاب با ماوس یا لمس
document.addEventListener('mousedown', function(e){
  // اگر بخواهی کلیک وسطی/راست هم غیرفعال باشند، اینجا می‌توان شرط گذاشت.
  // e.preventDefault();
}, {passive:false});

document.addEventListener('touchstart', function(e){
  // جلوگیری از انتخاب چند لمسی
  if (e.touches && e.touches.length > 1) e.preventDefault();
}, {passive:false});
</script>




  
<script>
/* ===========================
   تنظیمات: غیر فعال کردن زوم
   =========================== */
/* meta tag already sets maximum-scale=1 و user-scalable=no */
(function disableZoom(){
  // موبایل (دو انگشت)
  document.addEventListener('touchmove', function (e) {
      if (e.scale && e.scale !== 1) e.preventDefault();
  }, { passive: false });

  // Ctrl + wheel (دسکتاپ)
  window.addEventListener('wheel', function (e) {
      if (e.ctrlKey) e.preventDefault();
  }, { passive: false });

  // کلیدهای زوم
  document.addEventListener('keydown', function (e) {
      if (e.ctrlKey && (e.key === '+' || e.key === '-' || e.key === '=' || e.key === '0')) e.preventDefault();
      if ((e.metaKey || e.ctrlKey) && e.key === '0') e.preventDefault();
  });
})();

/* ===========================
   ابزارهای کمکی ریاضی و اعتبار سنجی
   =========================== */
function round(v, d=2){ return Number.parseFloat(v).toFixed(d); }
function isNumber(n){ return typeof n === 'number' && !isNaN(n) && isFinite(n); }

function getInputFloat(id){
  const el = document.getElementById(id);
  if(!el) return NaN;
  const v = parseFloat(el.value);
  return isNaN(v) ? NaN : v;
}

/* ===========================
   فرمول‌ها
   =========================== */
/* BMI */
function calcBMI(weightKg, heightCm){
  const h = heightCm / 100;
  if(!isNumber(weightKg) || !isNumber(h) || h <= 0) return NaN;
  return weightKg / (h*h);
}

/* دسته بندی BMI (WHO) */
function bmiCategory(bmi){
  if(!isNumber(bmi)) return "نامشخص";
  if (bmi < 16) return "کم‌وزن خیلی شدید";
  if (bmi < 17) return "کم‌وزن نسبتاً شدید";
  if (bmi < 18.5) return "کم‌وزن";
  if (bmi < 25) return "نرمال";
  if (bmi < 30) return "اضافه وزن (Overweight)";
  if (bmi < 35) return "چاقی کلاس I";
  if (bmi < 40) return "چاقی کلاس II";
  return "چاقی کلاس III (شدید)";
}

/* درصد چربی بدن - Deurenberg (متکی به BMI و سن و جنس) 
   bodyFat% = 1.20 * BMI + 0.23 * age - 10.8 * sex - 5.4
   sex: 1 = مرد, 0 = زن
*/
function bodyFatDeurenberg(bmi, age, sex){
  if(!isNumber(bmi) || !isNumber(age)) return NaN;
  const sexNum = (sex === 'male') ? 1 : 0;
  return 1.20*bmi + 0.23*age - 10.8*sexNum - 5.4;
}

/* درصد چربی - US Navy method (دقیق‌تر اگر اندازه‌ها موجود باشد)
   مردان: BF% = 495 / (1.0324 - 0.19077 * log10(waist - neck) + 0.15456 * log10(height)) - 450
   زنان: BF% = 495 / (1.29579 - 0.35004 * log10(waist + hip - neck) + 0.22100 * log10(height)) - 450
   اندازه‌ها باید در سانتی‌متر و log10 پایه 10.
*/
function bodyFatNavy({heightCm, neckCm, waistCm, hipCm, sex}){
  try{
    if([heightCm, neckCm].some(v => !isNumber(v))) return NaN;
    if(sex === 'male'){
      if(!isNumber(waistCm)) return NaN;
      const A = 1.0324 - 0.19077 * Math.log10(waistCm - neckCm) + 0.15456 * Math.log10(heightCm);
      return 495 / A - 450;
    } else {
      if(!isNumber(waistCm) || !isNumber(hipCm)) return NaN;
      const A = 1.29579 - 0.35004 * Math.log10(waistCm + hipCm - neckCm) + 0.22100 * Math.log10(heightCm);
      return 495 / A - 450;
    }
  } catch(e){ return NaN; }
}

/* توده بدون چربی LBM (Lean Body Mass) ساده (kg)
   LBM = weight * (100 - BF%) / 100
*/
function calcLBM(weightKg, bodyFatPercent){
  if(!isNumber(weightKg) || !isNumber(bodyFatPercent)) return NaN;
  return weightKg * (1 - bodyFatPercent/100);
}

/* وزن ایده‌آل: روش BMI هدف (22) و فرمول Devine (برای مرجع) */
function idealWeightByBMI(heightCm, targetBMI=22){
  const h = heightCm / 100;
  return targetBMI * h * h;
}

/* Devine formula (پایه اینچی) — تبدیل به متریک:
   male: 50.0 kg + 2.3 kg per inch over 5 ft
   female: 45.5 kg + 2.3 kg per inch over 5 ft
   1 inch = 2.54 cm ; 5ft = 152.4 cm
*/
function idealWeightDevine(heightCm, sex){
  const baseCm = 152.4;
  const inchOver = Math.max(0, (heightCm - baseCm) / 2.54);
  const perInch = 2.3;
  if(sex === 'male') return 50 + perInch * inchOver;
  return 45.5 + perInch * inchOver;
}

/* BMR — Mifflin-St Jeor
   مرد: BMR = 10*W + 6.25*H - 5*age + 5
   زن:  BMR = 10*W + 6.25*H - 5*age - 161
   H in cm, W in kg
*/
function calcBMR(weightKg, heightCm, age, sex){
  if(!isNumber(weightKg) || !isNumber(heightCm) || !isNumber(age)) return NaN;
  const base = 10*weightKg + 6.25*heightCm - 5*age;
  return sex === 'male' ? base + 5 : base - 161;
}

/* ===========================
   لودینگ هوشمند (نمایش پیشرفت و پیام‌ها)
   =========================== */
const loadingModal = document.getElementById('loadingModal');
const progressBar = document.getElementById('progressBar');
const loadingStep = document.getElementById('loadingStep');

function showLoadingSmart(minMs = 2000){
  loadingModal.style.display = 'flex';
  loadingModal.setAttribute('aria-hidden','false');
  progressBar.style.width = '0%';
  loadingStep.textContent = 'آماده‌سازی داده‌ها...';

  // شبیه‌سازی مراحل و افزایش تدریجی درصد
  const start = performance.now();
  const duration = Math.max(1800, minMs); // حداقل 1800ms
  let lastStep = 0;
  return new Promise(resolve => {
    function tick(now){
      const elapsed = now - start;
      let pct = Math.min(100, (elapsed / duration) * 100);
      // smoothing و تغییر پیام مرحله‌ای
      if(pct < 30) loadingStep.textContent = 'بررسی ورودی‌ها...';
      else if(pct < 60) loadingStep.textContent = 'انجام محاسبات عددی دقیق...';
      else if(pct < 85) loadingStep.textContent = 'برازش مدل و نتایج ثانویه...';
      else loadingStep.textContent = 'آماده‌سازی خروجی...';

      progressBar.style.width = pct + '%';

      // جلوه‌های مرحله‌ای
      if(elapsed < duration){
        requestAnimationFrame(tick);
      } else {
        progressBar.style.width = '100%';
        setTimeout(()=>{ // کمی مکث برای حس طبیعی
          loadingModal.style.display = 'none';
          loadingModal.setAttribute('aria-hidden','true');
          resolve();
        }, 220);
      }
    }
    requestAnimationFrame(tick);
  });
}

/* ===========================
   اتصال دکمه‌ها و منطق اصلی
   =========================== */
document.getElementById('clearBtn').addEventListener('click', ()=>{
  ['height','weight','age','waist','neck','hip'].forEach(id => { const el=document.getElementById(id); if(el) el.value=''; });
  ['outBMI','outStatus','outFat','outFatNavy','outIdealBMI','outIdealDevine','outLBM','outBMR','outTDEE','advice'].forEach(id => {
    const el = document.getElementById(id) || document.getElementById('advice');
    if(el) el.innerHTML = (id === 'advice') ? '' : '—';
  });
});

document.getElementById('calcBtn').addEventListener('click', async (e)=>{
  // خواندن ورودی‌ها
  const height = getInputFloat('height');
  const weight = getInputFloat('weight');
  const age = getInputFloat('age');
  const sex = document.getElementById('sex').value;
  const activity = parseFloat(document.getElementById('activity').value) || 1.0;
  const waist = getInputFloat('waist');
  const neck = getInputFloat('neck');
  const hip = getInputFloat('hip');

  // اعتبار سنجی دقیق
  const errors = [];
  if(!isNumber(height) || height < 50 || height > 272) errors.push('قد نامعتبر است (بین 50 تا 272 سانتی‌متر).');
  if(!isNumber(weight) || weight < 2 || weight > 635) errors.push('وزن نامعتبر است (بین 2 تا 635 کیلوگرم).');
  if(!isNumber(age) || age < 1 || age > 120) errors.push('سن نامعتبر است (بین 1 تا 120 سال).');
  if((isNumber(waist) && waist <= 0) || (isNumber(neck) && neck <= 0) || (isNumber(hip) && hip <= 0)) errors.push('اندازه‌های دوری باید مثبت باشند.');

  if(errors.length){
    const area = document.getElementById('advice');
    area.innerHTML = '<div class="warn">خطا: ' + errors.join(' &nbsp; | &nbsp; ') + '</div>';
    return;
  } else {
    document.getElementById('advice').innerHTML = '';
  }

  // نمایش لودینگ هوشمند حداقل 2 ثانیه
  await showLoadingSmart(2000);

  /* ===========================
     انجام محاسبات دقیق
     =========================== */
  const bmi = calcBMI(weight, height);
  const bmiRounded = isNumber(bmi) ? round(bmi, 2) : '—';
  const status = bmiCategory(bmi);

  // درصد چربی: ابتدا تلاش برای Navy اگر داده‌ها کامل باشند
  let fatNavy = NaN;
  if(isNumber(neck) && isNumber(waist) && isNumber(height) && (sex === 'male' || (sex==='female' && isNumber(hip)))) {
    fatNavy = bodyFatNavy({heightCm: height, neckCm: neck, waistCm: waist, hipCm: hip, sex});
  }

  // Deurenberg (fallback or supplementary)
  const fatDeurenberg = bodyFatDeurenberg(bmi, age, sex);

  // منتخب: اگر naval معتبر و عدد معقول بین 2% تا 75% باشه، ازش استفاده می‌کنیم، در غیر اینصورت از Deurenberg
  let chosenFat = NaN;
  if(isNumber(fatNavy) && fatNavy > 2 && fatNavy < 75) chosenFat = fatNavy;
  else if(isNumber(fatDeurenberg) && fatDeurenberg > 2 && fatDeurenberg < 75) chosenFat = fatDeurenberg;
  else chosenFat = NaN;

  const lbm = calcLBM(weight, chosenFat);
  const idealByBMI = idealWeightByBMI(height, 22);
  const idealDevine = idealWeightDevine(height, sex);
  const bmr = calcBMR(weight, height, age, sex);
  const tdee = isNumber(bmr) ? bmr * activity : NaN;

  /* ===========================
     نمایش خروجی‌ها
     =========================== */
  document.getElementById('outBMI').textContent = isNumber(bmi) ? bmiRounded : '—';
  document.getElementById('outStatus').textContent = status || '—';
  document.getElementById('outFat').textContent = isNumber(fatDeurenberg) ? round(fatDeurenberg,2) + '%' : '—';
  document.getElementById('outFatNavy').textContent = isNumber(fatNavy) ? round(fatNavy,2) + '%' : '—';
  document.getElementById('outIdealBMI').textContent = isNumber(idealByBMI) ? round(idealByBMI,2) + ' kg' : '—';
  document.getElementById('outIdealDevine').textContent = isNumber(idealDevine) ? round(idealDevine,2) + ' kg' : '—';
  document.getElementById('outLBM').textContent = isNumber(lbm) ? round(lbm,2) + ' kg' : '—';
  document.getElementById('outBMR').textContent = isNumber(bmr) ? round(bmr,0) + ' kcal/day' : '—';
  document.getElementById('outTDEE').textContent = isNumber(tdee) ? round(tdee,0) + ' kcal/day' : '—';

  // مشاوره خلاصه و نکات
  const adviceEl = document.getElementById('advice');
  let advHtml = '';
  if(isNumber(bmi)){
    advHtml += `<div class="small">براساس BMI (${round(bmi,2)}) وضعیت: <b>${status}</b>.</div>`;
    if(bmi < 18.5) advHtml += `<div class="note">پیشنهاد: افزایش تدریجی کالری با تمرکز روی پروتئین و تمرینات مقاومتی.</div>`;
    else if(bmi < 25) advHtml += `<div class="note">پیشنهاد: حفظ وضعیت کنونی؛ توازن کالری و فعالیت به حفظ وزن کمک می‌کند.</div>`;
    else advHtml += `<div class="note">پیشنهاد: کاهش کالری کنترل‌شده و افزایش فعالیت بدنی؛ مشاوره با متخصص تغذیه پیشنهاد می‌شود.</div>`;
  }

  if(isNumber(chosenFat)){
    advHtml += `<div class="small" style="margin-top:8px">درصد چربی برآوردی: <b>${round(chosenFat,2)}%</b>.</div>`;
    // سطح چربی تخمینی و توصیه
    if(chosenFat < 6) advHtml += `<div class="note">سطح چربی بسیار پایین — بررسی پزشکی توصیه می‌شود.</div>`;
    else if(chosenFat < 14) advHtml += `<div class="note">برای مردان در محدوده ورزشکارانه مناسب است.</div>`;
    else if(chosenFat < 18) advHtml += `<div class="note">محدوده مناسب/متوسط.</div>`;
    else if(chosenFat < 25) advHtml += `<div class="note">محدوده نسبتاً بالا — اصلاح رژیم و فعالیت مفید است.</div>`;
    else advHtml += `<div class="note">درصد چربی بالا — مشاوره تخصصی توصیه می‌شود.</div>`;
  }

  adviceEl.innerHTML = advHtml;
});
</script>
</body>
</html>
